# =========================================
# ENV PROD IUH - TEMPLATE (A COMPLETER)
# =========================================

# ---------------------
# Base de données IoT (Timescale)
# ---------------------
DB_USER=iot_app               # compte applicatif dédié
# exemple de mot de passe fort généré : use a password manager ou 0C7928C969D2030F0C6CD125DAC30365980D69947AEEF63A9C3AF18295D2F72F
DB_PASSWORD=CHANGE_ME_DB_PASSWORD_STRONG
DB_NAME=iot

# ---------------------
# Base de données Keycloak
# ---------------------
KEYCLOAK_DB_USER=keycloak
# exemple de mot de passe fort généré : use a password manager ou 13B6132776720D751940F0F277EDF401A8EF47EB1709E40187982F17EEC94DF1
KEYCLOAK_DB_PASSWORD=CHANGE_ME_KEYCLOAK_DB_PASSWORD_STRONG
KEYCLOAK_DB_NAME=keycloak

# ---------------------
# Keycloak (admin + hostname public)
# ---------------------
KEYCLOAK_ADMIN=admin
# exemple de mot de passe fort généré : use a password manager ou FCD886A670253F41A71FB220900395F8F0504A1AD322B15A004AC1EAE76C7D0C
KEYCLOAK_ADMIN_PASSWORD=CHANGE_ME_KEYCLOAK_ADMIN_PASSWORD_STRONG

# Hostname / FQDN tel qu'il sera vu par les navigateurs
# Exemple : KEYCLOAK_HOSTNAME=auth-iot.iuh.edu.vn
KEYCLOAK_HOSTNAME=CHANGE_ME_KEYCLOAK_HOST_OR_FQDN

# ---------------------
# Backend API
# ---------------------
API_LOG_LEVEL=info
API_RATE_LIMIT=1000/1m

# En prod : RBAC strict + check issuer + check aud
RBAC_ENFORCE=1
ALLOW_API_KEY_WITH_RBAC=0
OIDC_REQUIRE_AUD=1
OIDC_IGNORE_ISSUER=0

# CORS : SPA servie par nginx sur le FQDN IUH
# Exemple si le front est servi sur https://dashboard-iot.iuh.edu.vn
CORS_ORIGIN=https://CHANGE_ME_DASHBOARD_FQDN

# Source de données
DATA_SOURCE=kienlab

# ---------------------
# Intégration Kienlab
# ---------------------
# Proxy interne utilisé par le backend (ne change pas)
KIENLAB_BASE=http://nginx/kienlab

# Liste des devices Kienlab (MAC séparées par des virgules)
KIENLAB_DEVICES=F0:24:F9:57:59:18,3C:8A:1F:0B:7C:C4,D4:8A:FC:A5:ED:E0,3C:8A:1F:0B:70:D4,D4:8A:FC:99:66:68,3C:8A:1F:0B:6F:A8

# Auth Kienlab (si l'admin active une API key ou un header spécifique)
KIENLAB_AUTH_SCHEME=
KIENLAB_API_KEY=

KIENLAB_LENGTH=1000
KIENLAB_POLL_MS=5000
KIENLAB_MAX_INIT_ROWS=500
KIENLAB_DEBUG=0

# ---------------------
# API key technique (pour intégrations backend-to-backend)
# ---------------------
# exemple d'api key forte générée : use a password manager ou R&df_HZ-f5r!%$Gq@FwQ-uzlk%JNjPk*N6c082AQttbY%G9eJH^b86IlDEEFz9l
API_KEY=CHANGE_ME_STRONG_API_KEY

# ---------------------
# OIDC (backend interne -> Keycloak)
# ---------------------
OIDC_CLIENT_ID=iot-dashboard

# Doit matcher exactement "iss" des tokens en PROD
# Exemple sans TLS :  http://CHANGE_ME_KEYCLOAK_HOST_OR_FQDN:8080/realms/iot
# Exemple avec TLS :  https://CHANGE_ME_KEYCLOAK_HOST_OR_FQDN/realms/iot
OIDC_ISSUER_URL_INTERNAL=CHANGE_ME_OIDC_ISSUER_URL

# URL interne (réseau docker) pour JWKS
OIDC_JWKS_URL_INTERNAL=http://keycloak:8080/realms/iot/protocol/openid-connect/certs

# ---------------------
# Observabilité / métriques
# ---------------------
# En prod, protéger /metrics avec un token technique
# exemple de token fort généré : use a password manager ou D1E879509FEF92D3D584BE3131EF4844E7A5A22DD329E07D825B8A5C997F2972
METRICS_API_KEY=CHANGE_ME_STRONG_METRICS_API_KEY

# ---------------------
# SMTP / alertes email
# (à voir avec IUH : mail interne, SMTP universitaire, ou compte dédié)
# ---------------------
SMTP_HOST=CHANGE_ME_SMTP_HOST
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=CHANGE_ME_SMTP_USER
# mot de passe d'application google à créer si SMTP_USER est une adresse gmail !
SMTP_PASS=CHANGE_ME_SMTP_PASSWORD

ALERTS_FROM=CHANGE_ME_ALERTS_FROM
ALERTS_TO=CHANGE_ME_ALERTS_TO
ALERTS_MIN_LEVEL=crit
ALERTS_COOLDOWN_SECONDS=300

# ---------------------
# Grafana
# ---------------------
GRAFANA_ADMIN_USER=admin
# exemple de mot de passe fort généré : use a password manager ou FBEAB4882A8D6436880750C1C35603318477EBC492E68B22A0087EC3258D707B
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_ADMIN_PASSWORD_STRONG

# ---------------------
# Frontend (build Vite via nginx)
# ---------------------
# Exemple avec TLS :
#  VITE_OIDC_ISSUER_URL=https://CHANGE_ME_KEYCLOAK_HOST_OR_FQDN/realms/iot
#  VITE_OIDC_REDIRECT_URI=https://CHANGE_ME_DASHBOARD_FQDN
VITE_OIDC_ISSUER_URL=CHANGE_ME_VITE_OIDC_ISSUER_URL
VITE_OIDC_CLIENT_ID=iot-dashboard
VITE_OIDC_REDIRECT_URI=CHANGE_ME_VITE_REDIRECT_URI
VITE_REQUIRE_AUTH=1

# Si l'API est reverse-proxyée par le même Nginx : laisser vide => appels relatifs /api
VITE_API_BASE=
VITE_DATA_SOURCE=

# Cible réelle de Kienlab côté nginx (URL fournie par l'admin réseau)
# Exemple actuel : http://eprophet.kienlab.com
KIENLAB_PROXY_TARGET=http://eprophet.iuh.kienlab.com