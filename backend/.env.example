PORT=4000
DATABASE_URL=
REDIS_URL=

CORS_ORIGIN=http://localhost:5173,http://localhost:5174,http://localhost:*

RBAC_ENFORCE=0
ALLOW_API_KEY_WITH_RBAC=1
OIDC_ISSUER_URL=http://localhost:8080/realms/iot
OIDC_CLIENT_ID=iot-dashboard

DATA_SOURCE=kienlab
KIENLAB_BASE=http://eprophet.kienlab.com
KIENLAB_DEVICES=F0:24:F9:57:59:18,3C:8A:1F:0B:7C:C4,D4:8A:FC:A5:ED:E0,3C:8A:1F:0B:70:D4,D4:8A:FC:99:66:68,3C:8A:1F:0B:6F:A8
KIENLAB_API_KEY=
KIENLAB_POLL_MS=5000
KIENLAB_LENGTH=1000
KIENLAB_MAX_INIT_ROWS=500
KIENLAB_AUTH_SCHEME=Bearer

TSDB_MIRROR=0
TSDB_READ=0
TSDB_REFRESH_SECONDS=0
PREAGG_RETENTION_DAYS=90

LOG_LEVEL=debug
AUDIT_LOG_FILE=backend-audit.log

API_HMAC_ENFORCE=0
API_HMAC_KEY_ID=
API_HMAC_SECRET=

# --- Email alerts (SMTP) ---
# Configure these to enable email notifications to admins
SMTP_HOST=
SMTP_PORT=
SMTP_SECURE=
SMTP_USER=
SMTP_PASS=
ALERTS_FROM=
ALERTS_TO=
# Minimum alert level to notify by email: warn | crit
ALERTS_MIN_LEVEL=crit
# Cooldown between identical alerts to avoid spam (in seconds)
ALERTS_COOLDOWN_SECONDS=300
# Advanced TLS options (use defaults unless you know what you're doing)
# Force TLS on submission (STARTTLS):
SMTP_REQUIRE_TLS=
# Disable STARTTLS (insecure; useful for local dev tools like MailHog/Mailpit):
SMTP_IGNORE_TLS=0
# Certificate verification (0 = accept self-signed; 1 = verify, recommended):
SMTP_TLS_REJECT_UNAUTHORIZED=1

# --- Alerts routing (optional) ---
# Slack (Incoming Webhook). Leave ROUTE_SLACK=0 to disable.
ROUTE_SLACK=0
SLACK_WEBHOOK_URL=
SLACK_CHANNEL=
# Generic HTTP Webhook. Leave ROUTE_WEBHOOK=0 to disable.
ROUTE_WEBHOOK=0
WEBHOOK_URL=

REMOTE_BASE_URL=
REMOTE_POINTS_URL=
REMOTE_POLL_MS=2000
REMOTE_AUTH_HEADER=
REMOTE_AUTH_VALUE=
REMOTE_AUTH_SCHEME=Bearer
REMOTE_API_KEY=
REMOTE_WS_URL=
REMOTE_MQTT_URL=
REMOTE_MQTT_USER=
REMOTE_MQTT_PASS=
REMOTE_MQTT_TOPIC=points/#


########################################
# Options avancées - HTTP / sécurité
########################################

# Adresse d’écoute de l’API (en général 0.0.0.0 en conteneur)
SERVER_HOST=0.0.0.0

# Indique à Express qu’il est derrière un reverse proxy (Nginx, Traefik…)
# 0 = désactivé, 1 = faire confiance au 1er proxy
TRUST_PROXY=1

# Rate limiting: <req_par_fenetre>:<fenêtre_en_secondes>
# Exemple: 1000 requêtes sur 60s
RATE_LIMIT=1000:60

########################################
# Source de données Kienlab / mapping
########################################

# Mode d’ingestion: "kienlab" / "timescaledb" / autre (selon ce qui est câblé dans le code)
DATA_SOURCE=kienlab

# Active des logs supplémentaires sur les appels Kienlab (true/false)
KIENLAB_DEBUG=false

# Mapping avancé des devices Kienlab (si utilisé par le backend)
# Exemple de format (à adapter si le code utilise cette variable):
# KIENLAB_MAP=F0:24:F9:57:59:18:H2.3;3C:8A:1F:0B:7C:C4:H2.3
KIENLAB_MAP=

# Variante éventuelle si le code attend un mapping côté API
API_KIENLAB_MAP=

########################################
# HMAC / API key (intégration passerelle / webhook)
########################################

# Domaine attendu en entrée (ex: gateway externe, reverse proxy, etc.)
API_DOMAIN=

# Algo HMAC utilisé pour signer les requêtes (ex: sha256)
API_HMAC_ALGO=sha256

# Clé secrète utilisée pour vérifier la signature HMAC (NE PAS COMMITTER en clair dans .env.example)
API_HMAC_KEY=

# true = la signature HMAC est obligatoire pour certaines routes d’API, false = désactivé
API_HMAC_REQUIRED=false

# API key éventuelle pour des scripts batch / ingestion sans OIDC
API_KEY=
# Rôle associé à cette API key (ex: ingestor, admin… selon ton code)
API_KEY_ROLE=ingestor

########################################
# OIDC / JWT par défaut côté backend
########################################

# Issuer par défaut si aucun autre issuer n’est fourni (par exemple ton realm Keycloak)
# Pour IUH (actuel) tu pourrais mettre:
# DEFAULT_OIDC_ISSUER=http://192.168.2.30:8080/realms/iot
DEFAULT_OIDC_ISSUER=

# Audience par défaut attendue dans les tokens (souvent = clientId du frontend)
DEFAULT_OIDC_AUDIENCE=


########################################
# Limites de séries / performance API
########################################

# Nombre maximum de points retournés par une requête /api/timeseries
MAX_API_POINTS=5000

# Cap global sur la taille des séries manipulées (sécurité mémoire)
SERIES_CAP=20000

########################################
# Socket.IO (temps réel)
########################################

# Origine autorisée pour Socket.IO (CORS WebSocket)
# Exemple dev: http://localhost:5174
# Exemple prod IUH: http://192.168.2.30:8081
SOCKET_IO_CORS_ORIGIN=http://localhost:5174

# Chemin d’accès Socket.IO derrière Nginx
SOCKET_IO_PATH=/socket.io/

# Intervalle de ping (ms)
SOCKET_IO_PING_INTERVAL=20000

# Timeout de ping (ms)
SOCKET_IO_PING_TIMEOUT=30000

# Transports autorisés (séparer par des virgules)
SOCKET_IO_TRANSPORTS=websocket,polling
